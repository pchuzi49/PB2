/*
 MIT
 @constructor
*/
(function(s,y){var A=s.InSkin||(s.InSkin={}),x=A.PublisherCode||(A.PublisherCode={}),B=x.LIB||(x.LIB={}),C=x.tests||(x.tests={}),i,h=x.kwFiltersBase||(x.kwFiltersBase={}),v=s.document;(function(){i={};i.extend=function(e){e=e||{};for(var b=1;b<arguments.length;b++){var a=arguments[b];if(a)for(var c in a)if(typeof a[c]=="object"){if(typeof e[c]!="object")e[c]={};i.extend(e[c],a[c])}else e[c]=a[c]}return e};i.getURLParams=function(){try{for(var e={},b=s.location.search.substring(1).split("&"),a=0;a<
b.length;a++)if(b[a]){var c=b[a].split("=");e[c[0]]=c[1]?decodeURIComponent(c[1]):""}return e}catch(f){}return{}};i.getScriptParams=function(e,b){b||(b="&");for(var a=y.document.getElementsByTagName("script"),c,f=0;f<a.length;f++)if(a[f].getAttribute("data-ism-processed")!="true")if(c=a[f].src.match(e)){a[f].setAttribute("data-ism-processed","true");a={};if(c.length==3){b=c[1];c=c[2]}else c=c[1];c=c.split(b);for(f=0;f<c.length;f++)if(c[f]!=""){var d=c[f].split("=");a[d[0]]=d[1]?decodeURIComponent(d[1]):
""}return a}return null};i.jsonp=function(e){var b="ism_jsonp_"+i.random(),a=e.window||s,c,f=e.url;f+=(f.indexOf("?")>=0?"&":"?")+"callback="+b;if(e.data)for(var d in e.data){var g=e.data[d];switch(Object.prototype.toString.call(g)){case "[object Array]":for(var j=0;j<g.length;j++)f+="&"+d+"="+encodeURIComponent(g[j]);break;case "[object Object]":j=!e.flatten?d+".":"";for(var l in g)f+="&"+j+l+"="+encodeURIComponent(g[l]);break;case "[object Boolean]":f+="&"+d+"="+g.toString();break;default:f+="&"+
d+"="+encodeURIComponent(g)}}a[b]=function(k){c&&c.parentNode.removeChild(c);delete a[b];e.callback&&e.callback(k)};c=i.loadJS(f,a,e.async)};i.loadJS=function(e,b,a,c,f){function d(){if(!j){j=true;c()}}b||(b=s);f&&c&&setTimeout(d,f);if(!a&&b.document.readyState=="loading"){b.document.write('<script src="'+e+'"><\/script>');if(c){var g=g="ism_callback_"+i.random();b[g]=function(){d();delete b[g]};b.document.write("<script>"+g+"();<\/script>")}}else{a=b.document.createElement("script");a.setAttribute("type",
"text/javascript");a.setAttribute("src",e);if(c)a.onload=a.onerror=d;if(e=b.document.getElementsByTagName("head")[0]){e.appendChild(a);return a}}var j=false};i.runJS=function(e,b){if(b.document.readyState=="loading")b.document.write(e);else{var a=e.match(/^\s*<script[^>]+src\s*=\s*("|')(.+)\1[^>]*>/i);a?i.loadJS(a[2],b,true):eval(e.replace(/^\s*<script[^>]*>|<\/script>\s*$/ig,""))}};i.loadCSS=function(e,b){b||(b=v);var a=b.createElement("link");a.setAttribute("type","text/css");a.setAttribute("rel",
"stylesheet");a.setAttribute("href",e);var c=b.getElementsByTagName("head")[0];c&&c.appendChild(a)};i.getFrameDoc=function(e,b){b||(b=v);if(typeof e=="string")e=b.getElementById(e);try{if(e)return e.contentDocument?e.contentDocument:e.contentWindow?e.contentWindow.document:e.document}catch(a){}return null};i.getPageKeywords=function(e){if(e==undefined)e="meta-";for(var b=[],a=v.getElementsByTagName("meta"),c=0;c<a.length;c++)if(a[c].name&&a[c].name.toLowerCase()=="keywords")if(a[c].content)for(var f=
a[c].content.split(","),d=0;d<f.length;d++){var g=f[d].toLowerCase().replace(/[^a-z0-9]/g,"");g.length>1&&b.push(e+g)}return b};i.getURLPathKeywords=function(e){for(var b=[],a=s.location.pathname.split("/"),c="url",f=1,d=0;d<e&&f<a.length;){c+="-"+a[f];b.push(c);f++;d++}return b};i.ensureBooleans=function(e,b){for(var a,c=0;c<b.length;c++){a=b[c];if(typeof e[a]!="undefined")e[a]=String(e[a]).toLowerCase()=="true"?true:false}};i.ensureIntegers=function(e,b){for(var a,c=0;c<b.length;c++){a=b[c];if(typeof e[a]!=
"undefined")e[a]=parseInt(e[a])}};i.random=function(){return Math.floor(Math.random()*1E17)};i.extendCSV=function(e,b){e||(e="");return e+(e.length?",":"")+b};i.setCookie=function(e,b,a,c,f,d){if(a){var g=new Date;g.setTime(g.getTime()+a*1E3);a=g}e=e+"="+escape(b)+(a?"; expires="+a.toGMTString():"")+(c?"; path="+c:"")+(f?"; domain="+f:"")+(d?"; secure":"");v.cookie=e};i.getCookie=function(e){var b=v.cookie;e=e+"=";var a=b.indexOf("; "+e);if(a==-1){a=b.indexOf(e);if(a!=0)return null}else a+=2;var c=
v.cookie.indexOf(";",a);if(c==-1)c=b.length;return unescape(b.substring(a+e.length,c))};i.delCookie=function(e,b,a){if(this.getCookie(e))v.cookie=e+"="+(b?"; path="+b:"")+(a?"; domain="+a:"")+"; expires=Thu, 01-Jan-70 00:00:01 GMT"};i.storageSet=function(e,b,a){if(a)b.__expires=(new Date).getTime()+a*1E3;localStorage.setItem(e,JSON.stringify(b));i.delCookie(e,"/")};i.storageGet=function(e){e=(e=localStorage.getItem(e)||i.getCookie(e))?JSON.parse(e):{};if(e.__expires)if(e.__expires<(new Date).getTime())e=
{};else delete e.__expires;return e};i.storageDel=function(e){localStorage.removeItem(e);i.delCookie(e,"/")};i.setISAPCookies=function(e){var b={Session:1800,Persistent:31536E3};try{for(var a in b){var c="ISAP"+a,f=e[a+"Cookies"];if(f)i.storageSet(c,i.extend(i.storageGet(c),f),b[a]);else f===null&&i.storageDel(c)}}catch(d){}};i.getISAPCookies=function(){try{var e=i.storageGet("ISAPSession"),b=i.storageGet("ISAPPersistent"),a=i.extend({},e,b);e=[];for(var c in a)e.push(c+"=="+a[c]);return e.length?
{vstrCookieData:e.join("&&")}:{}}catch(f){}};i.loadURL=function(e,b){var a=new Image;if(b)a.onload=b;a.src=e};i.semvercmp=function(e,b){for(var a=e.split("."),c=b.split("."),f=0;f<3;f++){var d=parseInt(a[f]),g=parseInt(c[f]);if(d>g)return 1;if(g>d)return-1;if(!isNaN(d)&&isNaN(g))return 1;if(isNaN(d)&&!isNaN(g))return-1}return 0};i.bluekaiGet=function(e,b,a){i.loadJS("https://tags.bluekai.com/site/39716?ret=js&limit=1",b,a,function(){e(b.bk_results||{})},3E3)};i.bluekaiSet=function(e){s.bk_async=function(){for(var b in e)s.bk_addPageCtx(b,
e[b]);s.BKTAG.doTag(38862,4)};i.loadJS("https://tags.bkrtx.com/js/bk-coretag.js",s,true)};i.saveFlightIdViewTime=function(e){var b=Math.round((new Date).getTime()/1E3),a=JSON.parse(i.getCookie("MFADFlightViewTimes")||"{}");a[e]=a[e]||[];a[e].push(b);for(var c in a){a[c]=a[c].filter(function(f){return f+5184E3>b});a[c].length||delete a[c]}i.setCookie("MFADFlightViewTimes",JSON.stringify(a),0,"/")};i.loadInIframe=function(e){e="<html><head></head><body>"+e+"</body></html>";var b=v.createElement("iframe");
b.style.position="fixed";b.style.height="1px";b.style.width="1px";b.style.left="-10px";b.style.top="-10px";v.body.appendChild(b);b.contentWindow.document.open("text/html","replace");b.contentWindow.document.write(e);b.contentWindow.document.close()};i.embedUserMatchingIframe=function(){var e=v.createElement("iframe");e.width=e.height=e.frameborder=0;e.scrolling="no";e.style.display="none";var b="https://mfad.inskinad.com/udb/9874/sync/i.gif?partnerId=1&userKey="+i.getCookie("MFADUser")+"&userId=";
b="https://ssum-sec.casalemedia.com/usermatch?s=184665&cb="+encodeURIComponent(b);e.src=b;v.body.appendChild(e)}})();(function(){var e=false;B.IntegrationOverride={init:function(){this.telemetry=new B.Telemetry(this);this.dispatchEvent("init");this._updateParams();this.dispatchEvent("parametersSet");if(this.params.plr_EnableUserMatching&&i.getCookie("MFADUser"))this.params.plr_EnableUserMatching=="init"?i.embedUserMatchingIframe():this.on(this.params.plr_EnableUserMatching,function(){i.embedUserMatchingIframe()});
this._ISAPUrl=this.params.plr_UAT?"//staging.inskinad.com/ISAPAdServer/AdS.aspx":"//www.inskinad.com/ISAPAdServer/AdS.aspx";this.telemetry.recordImpression();this._runIntegrationTests()==false&&this._servePassback();var b=this;this._makeAdCall(function(a){if(b.params.plr_EnableBluekai&&!a&&!b.invalid)i.bluekaiSet({uid:a?a.upcv:"",SectionID:b.params.srv_SectionID,platform:b.meta.platform});if(b.params.srv_Forensiq&&b.params.plr_ForensiqPixel!==false){var c=["http://www.fqtag.com/pixel.cgi?org=5rafuw6aveY8fuPRar5R&p=",
b.params.srv_SectionID,"&cmp=",b.params.srv_AdvertIDs,"&fmt=banner&rt=displayImg&sl=1&fq=1&c1=",b.params.srv_Forensiq,"&ty=l"].join("");if(v.location.protocol=="http:"){b.telemetry.startTimer("forensiq-pixel");i.loadURL(c,function(){Math.random()<0.15&&b.telemetry.sendTimer("forensiq-pixel",1E3)})}}if(a){b.params.plr_CachedISAPResponse=a;b._loadBase(function(){b._bindjQuery();var f;b.params.plr_AdProvider=="MFAD"&&b.$(s).on("message",function(d){d=d.originalEvent;if(!(!d||!d.data||d.data.from!=="ism-rtb-companion"))f=
d.source});s.InSkinParams[b.params.plr_InSkinID]=b.params;b.base=new A.Base(b.params.plr_InSkinID);b.base.loadCSS("base.css");b.base.addEventListener("*",function(d){d.name=="ready"&&b.telemetry.recordBaseReady();if(d.name=="adServed"){b.telemetry.recordAdServed();if(b.params.plr_AdProvider=="MFAD"){i.saveFlightIdViewTime(a.flightId);a.body&&i.loadInIframe(a.body)}}if(d.name=="adDwellTime")if(b.params.plr_AdProvider=="MFAD"){var g=0;if(d.data["served-by-mfad"]&&d.data["served-by-mfad"].Expandable)g=
d.data["served-by-mfad"].Expandable;if(!b._expandableDwellTime)b._expandableDwellTime=0;var j=Math.floor(b._expandableDwellTime/20);b._expandableDwellTime+=g;n2=Math.floor(b._expandableDwellTime/20);n2>j&&n2<=15&&InSkin.Util.loadURL(b._responses.MFAD.response.customEvents[60+n2].url)}d.name=="window-load"&&b.telemetry.recordWindowLoad();d.name=="adClick"&&f&&f.postMessage({from:"ism-base"},"*");b.dispatchEvent(d.name,d.data,d.target)});b.base.init()})}else b._servePassback()})},destroy:function(){this.base&&
this.base.destroy();delete x.loadedPublisherScripts[this.id]},_runIntegrationTests:function(){var b=true,a,c;for(c in C)if(this.testParams[c]!==false){try{a=C[c].apply(this,this.testParams[c]||[])}catch(f){a=false}if(a!==true){b=false;this.invalid=true;if(typeof this.params.srv_Invalid=="undefined")this.params.srv_Invalid=true;this.failedTests[c]=a;this.telemetry.recordFailedTest(c,a)}}return b},_servePassback:function(){if(!e){e=true;var b;if(this.params.passback)b=this.params.passback;else if(typeof s.ISMPassback==
"function")b=s.ISMPassback();if(b){b=b.replace(/<\\script>/ig,"<\/script>");var a=this.params.plr_ServePassbackInParent?s:y;this.params.plr_ServePassbackInIframe?setTimeout(function(){var c=a.document.createElement("iframe");c.style.display="none";var f=a.document.getElementsByTagName("body")[0];f&&f.appendChild(c);if(c=i.getFrameDoc(c,a.document)){f="<!doctype html><html><body>"+b+"</body></html>";c.open();c.write(f);c.close()}},0):i.runJS(b,a)}}},_makeAdCall:function(b){var a=false,c=navigator.userAgent.toLowerCase();
if(c.indexOf("msie")!=-1&&parseInt(c.split("msie")[1])==9)a=true;if(this.invalid)a=true;if(this.params.srv_AdvertIDs&&this.params.srv_AdvertIDs!="NETWORK")a=true;if(a)for(a=this.params.plr_AdProviders.length-1;a>=0;a--)this.params.plr_AdProviders[a]=="MFAD"&&this.params.plr_AdProviders.splice(a,1);if(this.params.srv_AdvertIDs=="NETWORK"&&this.params.plr_AdProviders[0]=="ISAP"&&this.params.plr_AdProviders[1]=="MFAD")this.prioritizeMFAD=true;this._responses={};if(!this.params.plr_EnableBluekai||this.invalid)this._makeAdCallToNextProvider(b);
else{var f=this;this.telemetry.startTimer("bluekai-get");i.bluekaiGet(function(d){f.telemetry.sendTimer("bluekai-get");if(d.campaigns){for(var g=[],j=0;j<d.campaigns.length;j++)g.push("bk-"+d.campaigns[j].campaign);if(g.length){f.campaigns=g;f._addKeywords(g.join(","))}}f._makeAdCallToNextProvider(b)},y,this.async)}},_makeAdCallToNextProvider:function(b){var a=this._nextProviderIndex||0;if(!this.params.plr_AdProviders[a]||this.invalidatedByISAP){var c=null,f=null;if(this.prioritizeMFAD&&this._responses.ISAP&&
this._responses.ISAP.hasAd){this.params.plr_AdProvider="ISAP";c=this._responses.ISAP.response;f="ISAP"}return b(c,f)}this.params.plr_AdProvider=this.params.plr_AdProviders[a];this._nextProviderIndex=(this._nextProviderIndex||0)+1;this.telemetry.recordAdCall();var d=this;this["_make"+this.params.plr_AdProvider+"AdCall"](function(g){var j=d["_check"+d.params.plr_AdProvider+"Response"](g);d._responses[d.params.plr_AdProvider]={hasAd:j,response:g};if(d.params.plr_AdProvider=="ISAP"&&g&&g.Status!==0)d.invalidatedByISAP=
true;d.telemetry.recordAdCallResponse(j?g:null);if(d.params.plr_AdProvider=="ISAP"&&j){var l=g.PageSkinAd;if(d.prioritizeMFAD&&l.Priority&&l.Priority>3){d._makeAdCallToNextProvider(b);return}if(a==0)if(d.params.mf_flightId||d.params.mf_campaignId){d.params.plr_AdProviders[1]="MFAD";d._makeAdCallToNextProvider(b);return}}j?b(g,d.params.plr_AdProvider):d._makeAdCallToNextProvider(b)})},_makeISAPAdCall:function(b){this._sendRequestToISAP(b)},_sendRequestToISAP:function(b){var a={};if(this.params.plr_DirectAdCall)if(this.params.plr_AdvertID){a.method=
"GetCampaignInformationFromAdvertID";a.vintAdvertID=this.params.plr_AdvertID}else{if(this.params.plr_CreativeID){a.method="GetCampaignInformationFromCreativeID";a.vintCreativeID=this.params.plr_CreativeID}}else{a.method="GetCampaignInformationFromUserData";if(this.params.srv_Forensiq)this.params.srv_Forensiq=Math.floor(Math.random()*1E17);var c=[],f;for(f in this.params)f.match(/^srv_/i)&&c.push(f+"="+this.params[f]);a.vstrCampaignData=c.join("&")}i.extend(a,i.getISAPCookies());i.jsonp({window:y,
url:this._ISAPUrl,async:this.async,data:a,callback:function(d){d&&i.setISAPCookies(d);b&&b(d)}})},_checkISAPResponse:function(b){return!this.invalid&&b&&b.AdType?true:false},_makeMFADAdCall:function(b){var a=this;this._sendRequestToMFAD(function(c){c&&c.user&&i.setCookie("MFADUser",c.user.key,0,"/");var f;if(c&&c.decisions&&c.decisions.ad){f={SectionID:a.params.mf_siteId,AdType:"PageSkin2",PageSkinAd:c.decisions.ad.contents[0].data.customData};f.PageSkinAd.ProductType="PageSkinMF";f.PageSkinAd.CampaignLogID=
"served-by-mfad";c=c.decisions.ad;var d=f.PageSkinAd;d.CampaignID=c.campaignId;d.CreativeID=c.creativeId;d.AdvertID=c.flightId;d.LineItemID=c.adId;f.flightId=c.flightId;f.body=c.contents[0].body||"";f.customEvents=c.events;i.loadURL(c.impressionUrl);if(d.events){var g,j,l,k;for(k in d.events)if(g=k.match(/^(EXPANDABLE_)?EVENT_TAG_(\d+)$/)){j=parseInt(g[2]);l=d.events[k];l.trackers=l.trackers||[];l.trackers.push(c.events[j+(g[1]?40:0)].url);l.silent||l.trackers.push(c.clickUrl)}}d.impressionTrackers=
d.impressionTrackers||{};d.impressionTrackers[0]=d.impressionTrackers[0]||[];d.impressionTrackers[0].push({url:c.events[0].url})}b(f)})},_sendRequestToMFAD:function(b){var a={time:Math.round((new Date).getTime()/1E3),placements:[],url:this.params.plr_HidePageURL?"http://inskinad.com":s.location.href,keywords:this.params.srv_Keywords.split(",")};!this.params.mf_flightId&&!this.params.mf_campaignId&&a.keywords.push("MFNETWORK");var c=i.getCookie("MFADFlightViewTimes");if(c)a.flightViewTimes=JSON.parse(c);
c={divName:"ad",adTypes:[9,163,2163,3006],eventIds:[40]};for(var f=201;f<=240;f++)c.eventIds.push(f);for(f=261;f<=280;f++)c.eventIds.push(f);for(f=281;f<=295;f++)c.eventIds.push(f);for(var d in this.params)if(d.match(/^mf_/i))c[d.replace(/^mf_/,"")]=this.params[d];a.placements.push(c);var g=new XMLHttpRequest;g.withCredentials=true;g.open("POST","//mfad.inskinad.com/api/v2",this.async);g.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");g.onreadystatechange=function(){if(g.readyState==
4)g.status==200?b(JSON.parse(g.responseText)):b(null)};g.send(JSON.stringify(a))},_checkMFADResponse:function(b){return!this.invalid&&b?true:false},_loadBase:function(b){if(this.params.plr_ContentType){var a=false;if(!this.params.plr_UseFullVersion)if(typeof jQuery!="undefined"){var c=jQuery.fn.jquery;if(i.semvercmp(c,"1.4")>=0&&i.semvercmp(c,"1.7.2")<=0)a=true}a=[this.params.BASE_URL+"/js/base/api/",this.params.plr_ContentType.toLowerCase(),a?"-light":"",".js"].join("");i.loadJS(a,null,true,b)}},
_updateParams:function(){var b=this._getAdTagParams(),a;if(b){a=b.srv_Keywords;delete b.srv_Keywords}var c=i.getURLParams(),f;for(f in c)f!="BASE_URL"&&f!="DEBUG"&&!f.match(/^(srv|plr|mf)_/)&&delete c[f];this.params=i.extend({BASE_URL:"https://cdn.inskinad.com/isfe/4.1",srv_ResWidth:screen.width,srv_ResHeight:screen.height,plr_InSkinID:"myInSkin_"+i.random(),plr_AdProviders:["ISAP","MFAD"]},b,this.params,c);i.ensureBooleans(this.params,["srv_Invalid","srv_Forensiq","plr_ForensiqPixel","plr_DirectAdCall",
"plr_UAT","plr_UseFullVersion","plr_EnableBluekai","async","plr_ServePassbackInParent","plr_ServePassbackInIframe","plr_HidePageURL","plr_PageScan"]);i.ensureIntegers(this.params,["plr_URLKeywords","mf_siteId","mf_flightId","mf_campaignId"]);if(typeof this.params.async!="undefined")this.async=this.params.async;if(typeof this.params.plr_AdProviders=="string")this.params.plr_AdProviders=this.params.plr_AdProviders.split(/\s*,\s*/);a&&this._addKeywords(a);if(!this.params.srv_Keywords){b=i.getPageKeywords().join(",");
this.params.srv_Keywords=b}if(this.params.plr_URLKeywords){b=i.getURLPathKeywords(this.params.plr_URLKeywords).join(",");this._addKeywords(b)}},_getAdTagParams:function(){var b=i.getScriptParams(RegExp(this.id.replace("/","\\/")+"\\.js\\?autoload([^A-Za-z0-9]+)(.*)$"));if(b&&b.id){var a=y[b.id]||s[b.id];a&&i.extend(b,a);delete b.id;this.v2AdTag=true}return b},_addKeywords:function(){var b=Array.prototype.join.call(arguments,",");this.params.srv_Keywords=i.extendCSV(this.params.srv_Keywords,b)},_addPixel:function(b){if(this.$){b||
(b=this.$("body"));b.append('<img src="https://cdn.inskinad.com/isfe/resources/img/1x1.gif" id="ismIMG" width="100%" height="1px" />')}}}})();(function(){function e(a){this.integration=a;this._timers={};this.startTimer("since-load");this._features={custom:true,impression:false,"failed-test":false,"ad-call":false,"ad-call-response":false,"base-ready":false,"ad-served":false,"window-load":false,keywords:false,url:false};this._adcalls={}}B.Telemetry=e;var b=e.prototype;b.setup=function(a){i.extend(this._features,
a);if(this._features.keywords||this._features.url)this._features.impression=true};b.send=function(){if(this.integration.enableTelemetryTest)for(var a=0;a<arguments.length;a++){var c=arguments[a];c.pubfileId=this.integration.id;c.platform=this.integration.meta.platform||"unknown";c.ua=navigator.userAgent;if(c.type=="impression")c.url=s.location.href;if(c.type=="ad-call")if(this.integration.params.srv_Keywords)c.keywords=this.integration.params.srv_Keywords.split(",");i.jsonp({url:"https://mft1.inskinad.com/record",
data:c,flatten:true,async:true})}};b.recordCustom=function(a,c){this.send({type:"custom",label:a,value:c||0,url:s.location.href})};b.recordImpression=function(){var a={type:"impression",tagVersion:this.integration.params.version||null};if(this._features.keywords)a.keywords=i.getPageKeywords();if(this._features.url)a.url=s.location.href;this.send(a)};b.recordFailedTest=function(a,c){this.send({type:"failed-test",name:a,reason:c})};b.recordAdCall=function(){this._saveAdCallRequest();var a={type:"ad-call",
i_delay:this.getTimer("since-load")},c=this.integration.params;switch(c.plr_AdProvider){case "ISAP":a.advertId=c.srv_AdvertIDs||"";break;case "MFAD":a.campaignId=c.mf_campaignId||"";a.flightId=c.mf_flightId||""}this.addAdCallRequestData(a);this.send(a)};b._saveAdCallRequest=function(){var a=this.integration.params,c=null;switch(a.plr_AdProvider){case "ISAP":c={invalid:this.integration.invalid,direct:a.plr_DirectAdCall&&a.plr_DirectAdCall.toString()=="true",sectionId:a.srv_SectionID||""};break;case "MFAD":c=
{invalid:this.integration.invalid,siteId:a.mf_siteId||""}}if(c!==null)this._adcalls[a.plr_AdProvider]={request:c}};b.recordAdCallResponse=function(a){this._saveAdCallResponse(a);a={type:"ad-call-response",i_delay:this.getTimer("since-load")};this.addAdCallRequestData(a);this.addAdCallResponseData(a);this.integration.invalid||this.send(a)};b._saveAdCallResponse=function(a){var c=this.integration.params.plr_AdProvider;if(this._adcalls[c])if(a&&a.PageSkinAd){this._adcalls[c].hasResponse=true;var f=this._adcalls[c].response=
{sectionId:a.SectionID||"",campaignId:a.PageSkinAd.CampaignID,lineItemId:a.PageSkinAd.LineItemID||"",advertId:a.PageSkinAd.AdvertID,creativeId:a.PageSkinAd.CreativeID,productType:a.PageSkinAd.ProductType,vertical:a.PageSkinAd.Vertical||""};if(c=="ISAP"){f.priority=a.PageSkinAd.Priority;f.status=a.Status}}};b.recordBaseReady=function(){var a={type:"base-ready",i_delay:this.getTimer("since-load")};this.addAdCallRequestData(a);this.addAdCallResponseData(a);this.send(a)};b.recordAdServed=function(){var a=
{type:"ad-served",i_delay:this.getTimer("since-load")};this.addAdCallRequestData(a);this.addAdCallResponseData(a);if(a.provider=="MFAD"&&this.integration.prioritizeMFAD){var c=this.integration._responses;if(c.ISAP&&c.ISAP.hasAd){a.isapCampaignId=c.ISAP.response.PageSkinAd.CampaignID;a.isapAdvertId=c.ISAP.response.PageSkinAd.AdvertID}}this.send(a)};b.recordWindowLoad=function(){var a={type:"window-load",i_delay:this.getTimer("since-load")};this.addAdCallRequestData(a);this.addAdCallResponseData(a);
this.send(a)};b.addAdCallRequestData=function(a){var c=this.integration.params.plr_AdProvider;if(this._adcalls[c]&&this._adcalls[c].request){var f=this._adcalls[c].request;a.provider=c;if(f.invalid)a.b_invalid=true;switch(c){case "ISAP":if(f.direct)a.b_direct=true;if(f.sectionId)a.sectionId=f.sectionId;if(f.advertId)a.advertId=f.advertId;break;case "MFAD":if(f.siteId)a.siteId=f.siteId;if(f.campaignId)a.campaignId=f.campaignId;if(f.flightId)a.flightId=f.flightId}}};b.addAdCallResponseData=function(a){var c=
this.integration.params.plr_AdProvider;if(this._adcalls[c]){c=this._adcalls[c].response||{};var f=["vertical"],d;for(d in c){var g;a:{for(g=0;g<f.length;g++)if(f[g]==d){g=g;break a}g=-1}g>=0||(a[d]=c[d])}}};b.startTimer=function(a){a=this._timers[a]||(this._timers[a]={total:0});if(!a.started){a.started=true;a.since=(new Date).getTime()}};b.stopTimer=function(a){var c=this._timers[a]||null;if(c&&c.started){c.started=false;c.total+=(new Date).getTime()-c.since}return this.getTimer(a)};b.getTimer=function(a){a=
this._timers[a]||null;var c=0;if(a){c=a.total;if(a.started)c+=(new Date).getTime()-a.since}return c};b.sendTimer=function(a,c){var f=this.getTimer(a);if(c)f=Math.min(c,f);f&&this.recordCustom("timer-"+a,f)}})();var E=function(){function e(d,g){this.stem=d||"";this.nstem=this.stem.charCodeAt(0);this.sorting=g||e.SORT_DESC;this.prefixCount=this.wordCount=0;this.children=[];this.meta=[]}function b(d,g,j){if(!d||!g||!j)return null;for(var l,k,w,q;d.length>0;){l=d.charAt(0);k=g.children;w=k.length;for(q=
0;q<w;++q)if(l==k[q].stem)break;if(q==w)return null;d=d.substring(1);l=g;g=k[q]}return j(l,q)}function a(d,g){var j=d.nstem,l=g.nstem;return j<l?1:j>l?-1:0}function c(d,g){var j=d.nstem,l=g.nstem;return j>l?1:j<l?-1:0}e.SORT_ASC=1;e.SORT_DESC=2;e.SORT_NONE=4;var f=["stem","nstem","sorting","wordCount","prefixCount","meta"];e.prototype={add:function(d,g){if(d){var j,l=this.sorting,k=0,w=d.charAt(0),q=this.children,m=q.length;g=g||{};if(!g.word)g.word=d;for(;k<m;++k)if(q[k].stem==w){j=q[k];break}if(!j){++this.prefixCount;
j=new e(w,l);if(!l||!q.length||l&e.SORT_NONE)q.push(j);else if(l&e.SORT_DESC){k=m;do if(--k<0){q.unshift(j);break}while(q[k].stem>w);k>=0&&q.splice(k+1,0,j)}else{k=0;--m;do if(++k>m){q.unshift(j);break}while(q[k].stem>w);k<=m&&q.splice(k,0,j)}}j.add(d.substring(1),g)}else{this.meta.push(g);++this.wordCount}},update:function(d,g,j){this.remove(d);this.add(g,j)},remove:function(d){b(d,this,function(g,j){g.children.remove(j)})},find:function(d){return b(d,this,function(g,j){return g.children[j]})},findPrefix:function(d){return this.find(d)},
getChild:function(d){for(var g=0,j=this.children,l=j.length;g<l;++g)if(j[g].stem==d)return j[g];return null},hasChild:function(d){return this.getChild(d)!==null},sort:function(d){if(typeof d=="undefined")d=e.SORT_DESC;if(!(!this.prefixCount||this.sorting===d)){this.sorting=d;if(!(d&e.SORT_NONE)){var g=this.children,j=g.length-1;for(g.sort(d&e.SORT_ASC?a:c);j>=0;--j)g[j].sort(d)}}},getWords:function(){for(var d=[],g=this.children,j=0,l=g.length;j<l;++j){if(g[j].wordCount)d=d.concat(g[j].meta.map(function(k){return k.word}));
d=d.concat(g[j].getWords())}return d},getPrefixCount:function(d){return b(d,this,function(g,j){return g.children[j].prefixCount})||0},getWordCount:function(d){return b(d,this,function(g,j){return g.children[j].wordCount})||0},toString:function(){return"[Trie] '"+this.stem+"': {\n    stem: "+this.stem+",\n    prefixCount: "+this.prefixCount+",\n    wordCount: "+this.wordCount+",\n    metadata: "+JSON.stringify(this.meta)+",\n    children: [Array]{"+this.children.length+"}\n}"},fromJSON:function(d){f.forEach(function(g){this[g]=
d[g]}.bind(this));this.children=d.children.map(function(g){var j=new e;j.fromJSON(g);return j})},toJSON:function(){var d={children:this.children.map(function(g){return g.toJSON()})};f.forEach(function(g){d[g]=this[g]}.bind(this));return d}};return e}();h.attack={keyword:"sensitive_content",fullWord:false};h.behead={keyword:"sensitive_content",fullWord:false};h.blast={keyword:"sensitive_content",fullWord:false};h.bomb={keyword:"sensitive_content",fullWord:false};h["child, porn"]={keyword:"sensitive_content",
fullWord:false};h["child, sex"]={keyword:"sensitive_content",fullWord:false};h.collided={keyword:"sensitive_content",fullWord:false};h.collision={keyword:"sensitive_content",fullWord:false};h.crash={keyword:"sensitive_content",fullWord:false};h.dead={keyword:"sensitive_content",fullWord:false};h.disaster={keyword:"sensitive_content",fullWord:false};h["emergency, landing"]={keyword:"sensitive_content",fullWord:false};h.evacuate={keyword:"sensitive_content",fullWord:false};h.evacuation={keyword:"sensitive_content",
fullWord:false};h.explosion={keyword:"sensitive_content",fullWord:false};h.explosive={keyword:"sensitive_content",fullWord:false};h.extremist={keyword:"sensitive_content",fullWord:false};h.hostage={keyword:"sensitive_content",fullWord:false};h.incest={keyword:"sensitive_content",fullWord:false};h.jihad={keyword:"sensitive_content",fullWord:false};h.knife={keyword:"sensitive_content",fullWord:false};h.massacre={keyword:"sensitive_content",fullWord:false};h.murder={keyword:"sensitive_content",fullWord:false};
h.paedophile={keyword:"sensitive_content",fullWord:false};h["plane, crash"]={keyword:"sensitive_content",fullWord:false};h.racist={keyword:"sensitive_content",fullWord:false};h.suicide={keyword:"sensitive_content",fullWord:false};h.terror={keyword:"sensitive_content",fullWord:false};h.weapon={keyword:"sensitive_content",fullWord:false};h.die={keyword:"sensitive_content",fullWord:true};h.died={keyword:"sensitive_content",fullWord:true};h.dies={keyword:"sensitive_content",fullWord:true};h.gun={keyword:"sensitive_content",
fullWord:true};h.gunned={keyword:"sensitive_content",fullWord:true};h.guns={keyword:"sensitive_content",fullWord:true};h.isil={keyword:"sensitive_content",fullWord:true};h.isis={keyword:"sensitive_content",fullWord:true};h["islamic state"]={keyword:"sensitive_content",fullWord:true};h.kill={keyword:"sensitive_content",fullWord:true};h.killed={keyword:"sensitive_content",fullWord:true};h.killer={keyword:"sensitive_content",fullWord:true};h.killers={keyword:"sensitive_content",fullWord:true};h.killing=
{keyword:"sensitive_content",fullWord:true};h.kills={keyword:"sensitive_content",fullWord:true};h.rape={keyword:"sensitive_content",fullWord:true};h.raped={keyword:"sensitive_content",fullWord:true};h.rapes={keyword:"sensitive_content",fullWord:true};h.raping={keyword:"sensitive_content",fullWord:true};h.rapist={keyword:"sensitive_content",fullWord:true};h.shoot={keyword:"sensitive_content",fullWord:true};h.shooter={keyword:"sensitive_content",fullWord:true};h.shooters={keyword:"sensitive_content",
fullWord:true};h.shooting={keyword:"sensitive_content",fullWord:true};h.shootout={keyword:"sensitive_content",fullWord:true};h.shootouts={keyword:"sensitive_content",fullWord:true};h.shot={keyword:"sensitive_content",fullWord:true};h.stab={keyword:"sensitive_content",fullWord:true};h.stabbed={keyword:"sensitive_content",fullWord:true};h.stabber={keyword:"sensitive_content",fullWord:true};h.stabbing={keyword:"sensitive_content",fullWord:true};h.stabbings={keyword:"sensitive_content",fullWord:true};
h.stabs={keyword:"sensitive_content",fullWord:true};h.alcohol={keyword:"alcohol",fullWord:false};h.drunk={keyword:"alcohol",fullWord:false};h.vodka={keyword:"alcohol",fullWord:false};h.brawl={keyword:"alcohol",fullWord:false};h.binge={keyword:"alcohol",fullWord:false};h["congestion charge"]={keyword:"congestioncharge",fullWord:false};h["congestion-charge"]={keyword:"congestioncharge",fullWord:false};h.congestioncharge={keyword:"congestioncharge",fullWord:false};h["diesel scandal"]={keyword:"congestioncharge",
fullWord:false};h.cartel={keyword:"congestioncharge",fullWord:false};h.daimler={keyword:"congestioncharge",fullWord:false};h.collusion={keyword:"congestioncharge",fullWord:false};h.assault={keyword:"iwcingenieur_sensitive",fullWord:false};h.crash={keyword:"iwcingenieur_sensitive",fullWord:false};h.crime={keyword:"iwcingenieur_sensitive",fullWord:false};h.death={keyword:"iwcingenieur_sensitive",fullWord:false};h.disaster={keyword:"iwcingenieur_sensitive",fullWord:false};h.homosexual={keyword:"iwcingenieur_sensitive",
fullWord:false};h.layoff={keyword:"iwcingenieur_sensitive",fullWord:false};h.military={keyword:"iwcingenieur_sensitive",fullWord:false};h.murder={keyword:"iwcingenieur_sensitive",fullWord:false};h.racism={keyword:"iwcingenieur_sensitive",fullWord:false};h.rape={keyword:"iwcingenieur_sensitive",fullWord:false};h.sexism={keyword:"iwcingenieur_sensitive",fullWord:false};h.terrorism={keyword:"iwcingenieur_sensitive",fullWord:false};h.unemployment={keyword:"iwcingenieur_sensitive",fullWord:false};C.kwfilters=
function(){function e(m,r,t){var p=m,n="";r=r.split("");for(var u=0,o=[];;){for(k=u;k<r.length;k++)if(p=p.hasChild(r[k])?p.getChild(r[k]):null){n+=r[k];p=p;if(m.getWordCount(n)!=0)if(t)o.push(n);else return[n]}else{p=m;k-=n.length;n=""}if(n=="")return o.length?o:false;else{p=m;u=k-n.length+1;n=""}}}function b(m,r){if(!m)return false;for(var t=[],p=0;p<m.length;p++){var n=m[p];if(typeof r.hash[n].keyword!="undefined")if(!r.hash[n].fullWord||RegExp("\\b"+n+"\\b","i").test(j)){t.push(n);a(r.hash[n].keyword)}if(r.hash[n].groups)for(var u=
0;u<r.hash[n].groups.length;u++){var o=r.groups[r.hash[n].groups[u]];if(!o.fullWord||RegExp("\\b"+n+"\\b","i").test(j))o.kws[n]=true}}for(p=0;p<r.groups.length;p++){o=r.groups[p];n=true;for(var z in o.kws)n=n&&o.kws[z];if(n){t.push(o.keywords);a(o.keyword)}}return t}function a(m){if(m===false)d=l.params.srv_Invalid=true;else if(!f[m]){f[m]=true;l._addKeywords(m)}}if(this.params.srv_AdvertIDs!="NETWORK"||this.disableKWFilters)return true;var c,f={},d=false,g,j,l=this;for(c in x.kwFilters)h[c]=x.kwFilters[c];
c=function(m){var r={invalidate:{trie:new E,hash:{},groups:[]},substitute:{trie:new E,hash:{},groups:[]}},t,p,n,u,o;for(o in m){n=false;if(typeof m[o]=="object"){if(m[o].from&&m[o].from.getTime()>(new Date).getTime())continue;if(m[o].to&&m[o].to.getTime()<(new Date).getTime())continue;p=m[o].keyword;n=!!m[o].fullWord}else p=m[o];u=p===false?r.invalidate:r.substitute;if(o.indexOf(",")>=0){p={kws:{},keyword:p,keywords:o,fullWord:n};n=u.groups.push(p)-1;for(var z=o.split(/,/),D=0;D<z.length;D++){t=z[D].toLowerCase().replace(/[^a-z0-9 ]/g,
"");u.trie.add(t);p.kws[t]=false;u.hash[t]||(u.hash[t]={groups:[]});u.hash[t].groups.push(n)}}else{t=o.toLowerCase().replace(/[^a-z0-9 ]/g,"");u.trie.add(t);u.hash[t]||(u.hash[t]={});u.hash[t].keyword=p;u.hash[t].fullWord=n}}return r}(h);g=[v.title].concat(i.getPageKeywords(""));j=g.join(" ");for(var k=0;k<g.length;k++)g[k]=g[k].toLowerCase().replace(/[^a-z0-9 ]/g,"");b(e(c.invalidate.trie,g.join(" "),true),c.invalidate);if(this.params.plr_PageScan&&v.body){var w;if(this.params.plr_PageScanInclude)w=
Array.prototype.reduce.call(v.body.querySelectorAll(this.params.plr_PageScanInclude),function(m,r){return m+r.innerText},"");else if(this.params.plr_PageScanExclude){w=this.params.plr_PageScanExclude.split(/\s*,\s*/);var q=v.body.cloneNode(true);for(k=0;k<w.length;k++)q.querySelectorAll(w[k]).forEach(function(m){m.parentNode.removeChild(m)});w=q.innerText}else w=v.body.innerText;g.push(w.toLowerCase().replace(/[^a-z0-9 ]/g,""));j+=" "+w}b(e(c.substitute.trie,g.join(" "),true),c.substitute);return!d}})(window.ismWindow,
window);
